name: Monthly Investment Check

on:
  schedule:
    # 每月1日早上9點（台灣時間）提醒執行
    - cron: '0 22 3 * *'
  workflow_dispatch:
    inputs:
      cape_value:
        description: 'Shiller CAPE 當前數值（查 multpl.com/shiller-pe）'
        required: false
        default: ''
      pmi_prev:
        description: 'ISM PMI 前期數值（上個月，用來判斷趨勢）'
        required: false
        default: ''
      pmi_value:
        description: 'ISM製造業PMI（查 ismworld.org 或 investing.com）'
        required: false
        default: ''

jobs:
  monthly-check:
    runs-on: ubuntu-latest
    steps:
      - name: 取得程式碼
        uses: actions/checkout@v4

      - name: 設定Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安裝套件
        run: pip install requests groq

      - name: 執行月度檢查
        run: python monthly_check.py
        env:
          TELEGRAM_TOKEN:   ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GROQ_API_KEY:     ${{ secrets.GROQ_API_KEY }}
          FRED_API_KEY:     ${{ secrets.FRED_API_KEY }}
          CAPE_MANUAL: ${{ github.event.inputs.cape_value }}
          PMI_MANUAL:  ${{ github.event.inputs.pmi_value }}
          PMI_PREV: ${{ github.event.inputs.pmi_prev }}
